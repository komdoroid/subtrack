# 年間支出見積もり機能 要件定義

## 概要
Firestoreに登録されたサブスクリプションデータを元に、現在の契約状況から「今年1年間にかかる予定の合計支出金額」を算出し、UI上に表示する機能を実装する。

## 対象データ構造
各サブスクリプション（例：subscriptionsコレクション）は以下のプロパティを持つ前提とする。

```ts
interface Subscription {
  id: string
  name: string              // サービス名（例：Netflix）
  category: string          // カテゴリ（例：動画配信）
  amount: number            // 月額金額（例：1500）
  startDate: string         // 開始日 (例: "2024-04-01") ※ISO形式
  endDate: string | null    // 終了日 (例: "2024-10-31" または null)
}
```

## 要件詳細

### 1. 年間支出の合計計算

- 今年度（1月〜12月）にかかる支出の合計を算出する。
- `startDate` ～ `endDate` の範囲内で、今年に該当する月のみを対象とする。
- `endDate` が `null` の場合は、今年の12月31日まで契約が続くものとして扱う。
- `startDate` が今年より前でも、1月1日以降の月を対象に含める。
- `startDate` が今年より後の場合は、その月からカウントを開始する。

#### 算出例

| startDate   | endDate     | 対象期間        | 月数 | 計算式           | 結果     |
|-------------|-------------|----------------|------|------------------|----------|
| 2024-04-01  | 2024-10-31  | 4月〜10月       | 7    | 1500×7           | ¥10,500  |
| 2023-01-01  | null        | 1月〜12月       | 12   | 1500×12          | ¥18,000  |
| 2024-11-01  | null        | 11月〜12月      | 2    | 1500×2           | ¥3,000   |
| 2025-03-01  | 2025-07-31  | （対象外）       | 0    | -                | ¥0       |

---

### 2. UI要件

#### 2.1 初期表示
- ページ表示時には「今年度の年間支出合計金額」のみを中央に大きく表示する。
  - 例：`年間支出見積もり：¥85,500`

#### 2.2 ブレークダウン（クリック展開）
- 合計金額をクリックまたはトグル操作で展開し、以下の情報を表示する。
  - カテゴリ別の小計（例：動画配信：¥28,500、教育：¥36,000）
  - 各カテゴリ内のサービス一覧（サービス名・期間・金額）

#### 2.3 サービス利用期間の表記
- 各サービスに対して「◯ヶ月間利用」の表記を添える。
  - 例：`Netflix（7カ月間利用）¥10,500`

---

## 実装補足

- 年月計算には `date-fns` や `luxon` などのライブラリを利用すること。
  - `differenceInCalendarMonths`, `parseISO`, `isBefore`, `isAfter` 等が有用
- サブスクリプションの対象月は、日付の大小で判断し、月単位で切り出すこと。
- 表示上、カテゴリまたは金額順で並び替えることで UX を向上させる。

---

## 拡張案（将来的なオプション）

- ✅ 解約シミュレーション（チェックボックスで支出額を変動）
- ✅ 前年度支出との比較差分
- ✅ 月別支出のグラフ表示との連携
- ✅ 来年の支出予測機能（長期契約プランを含む）

---

## 備考

- 本機能はユーザーが「年間支出の全体像を把握し、見直し判断を行う」ことを目的とする。
- Firebase Authentication でログイン中のユーザーのデータのみを対象とすること。
